<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="icon" href="./favicon.ico?v=1"/>
  <link rel="shortcut icon" href="./favicon.ico?v=1"/>
  <title>DINALOG ‚Äî RH Biom√©trico (HE / TXT / Alimentaci√≥n)</title>

  <style>
    /* RESET B√ÅSICO */
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background: #f4f6f9; color: #333; }
    * { box-sizing: border-box; }

    /* TOPBAR (Header) */
    .topbar {
      background: linear-gradient(90deg, #0b1f3a, #133a74);
      color: #fff; padding: 12px 16px; 
      display: flex; align-items: center; gap: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      position: sticky; top: 0; z-index: 1000;
    }
    .topbar img { width: 36px; height: 36px; object-fit: contain; }
    .topbar .title { flex: 1; display: flex; flex-direction: column; line-height: 1.2; overflow: hidden; }
    .topbar .title-main { font-size: 14px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .topbar .title-sub { font-size: 11px; color: #cbd5e1; }
    .topbar .top-actions select { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.3); padding: 5px; border-radius: 6px; }
    .topbar .top-actions select option { background: #0b1f3a; color: #fff; }

    /* LAYOUT GENERAL (GRID) */
    .page { padding: 15px; max-width: 1400px; margin: 0 auto; }
    .grid { display: grid; grid-template-columns: 380px 1fr; gap: 20px; align-items: start; }

    /* TARJETAS */
    .card { background: #fff; border: 1px solid #e0e0e0; border-radius: 12px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
    
    /* TIPOGRAF√çA Y FORMULARIOS */
    h1 { font-size: 16px; margin: 0 0 10px 0; color: #0b1f3a; border-bottom: 2px solid #eee; padding-bottom: 5px; }
    label { display: block; font-size: 11px; font-weight: 600; color: #555; margin-top: 10px; margin-bottom: 4px; text-transform: uppercase; }
    select, input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-size: 14px; background: #fff; }
    .muted { color: #666; font-size: 11px; line-height: 1.4; }

    /* BOTONES */
    button { padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s; }
    button:active { transform: scale(0.98); }
    .btn-main { background: #0b1f3a; color: white; width: 100%; margin-bottom: 5px; }
    .btn-action { background: #e2e8f0; color: #333; border: 1px solid #cbd5e1; flex: 1; }
    .btn-secondary { background: #fff; color: #666; border: 1px solid #ccc; }

    /* KPIS (TARJETAS DE N√öMEROS) */
    .kpi { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; }
    .kpi .box { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 10px; text-align: center; }
    .kpi .value { font-size: 18px; font-weight: 800; color: #0b1f3a; margin-top: 5px; }

    /* TABLAS Y TABS */
    .tabs { display: flex; gap: 5px; overflow-x: auto; padding-bottom: 5px; margin-bottom: 10px; }
    .tab { white-space: nowrap; padding: 6px 12px; border-radius: 20px; background: #f1f5f9; font-size: 12px; color: #64748b; border: 1px solid transparent; cursor: pointer; }
    .tab.active { background: #0b1f3a; color: white; font-weight: 600; }
    
    .scroll { max-height: 300px; overflow: auto; border: 1px solid #e2e8f0; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; font-size: 11px; white-space: nowrap; }
    th { background: #f1f5f9; color: #475569; padding: 8px; text-align: left; position: sticky; top: 0; }
    td { padding: 8px; border-bottom: 1px solid #f1f5f9; }

    /* GR√ÅFICOS */
    .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }

    /* =========================================
       RESPONSIVE (M√ìVIL) - AQU√ç EST√Å LA MAGIA
       ========================================= */
    @media (max-width: 900px) {
      .grid { grid-template-columns: 1fr; } /* Pila vertical */
      
      /* Botones m√°s grandes para dedos */
      .row { flex-direction: column; align-items: stretch; }
      .row > * { width: 100%; margin-bottom: 5px; }
      #btnQuery, #btnPdf, #btnDirectorCycle, #btnDirectorHistory { width: 100%; margin: 5px 0; padding: 12px; }
      
      /* KPIs en 2 columnas en vez de 6 */
      .kpi { grid-template-columns: repeat(2, 1fr); }
      
      /* Gr√°ficos uno debajo de otro */
      .charts-grid { grid-template-columns: 1fr; }
      
      /* Ajuste header */
      .topbar { flex-wrap: wrap; }
      .topbar .title-main { font-size: 13px; white-space: normal; }
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
  <div class="topbar">
    <img src="icons/icon-512.png" alt="Logo" width="40" height="40" onerror="this.style.display='none'">
    <div class="title">
      <div class="title-main">DINALOG ‚Äî RH Biom√©trico (HORAS EXTRAS / TXT / ALIMENTACI√ìN) ‚Äî CEDIS PANAM√Å</div>
      <div class="title-sub">
        <span id="currentDateTime">Dashboard Recursos Humanos ¬∑ v1.0</span>
      </div>
    </div>
    <div class="top-actions">
      <select id="themeMode" class="theme-select" title="Tema">
        <option value="auto">Sistema</option>
        <option value="light">Claro</option>
        <option value="dark">Oscuro</option>
      </select>
    </div>
  </div>

  <div class="page">
    <div class="grid">
      <!-- LEFT -->
      <div class="card">
        <h1>Consulta</h1>
        <div class="muted">Fuente: Reporte Biometrico + Apps Script) ‚Üí Validacion de Analista Pendiente.</div>

        <label>Empleado</label>
        <select id="employee"></select>

        <label>Ciclo (16 ‚Üí 15)</label>
        <select id="cycle">
          <option value="manual">Rango manual</option>
        </select>
        <div class="muted">El TXT y el CAP 40h se calculan por cierre de ciclo (16‚Üí15).</div>

        <div class="row" style="margin-top:8px;">
          <div>
            <label>Desde</label>
            <input id="from" type="date">
          </div>
          <div>
            <label>Hasta</label>
            <input id="to" type="date">
          </div>
        </div>

        <div class="row" style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <button id="btnQuery" class="btn-main">Consultar</button>
          <button id="btnPdf" class="btn-action">PDF Individual</button>
          <div style="width:1px; height:25px; background:#ccc; margin:0 5px;"></div>
          <button id="btnDirectorCycle" class="btn-action" style="background-color:#0b1f3a; color:white; border:none;">
            üìä Director (Ciclo)
          </button>
          <button id="btnDirectorHistory" class="btn-action" style="background-color:#c0392b; color:white; border:none;">
            üìà Director (Hist√≥rico)
          </button>
        </div>

        <div style="margin-top:8px;">
          <button id="btnClear" class="btn-secondary" style="width:100%;">Limpiar</button>
        </div>

        <div id="status" class="muted" style="margin-top:10px;"></div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <h1>KPIs del rango</h1>
        <div class="kpi">
          <div class="box"><div class="muted">Eventos</div><div class="value" id="kpiEvents">0</div></div>
          <div class="box"><div class="muted">D√≠as</div><div class="value" id="kpiDays">0</div></div>
          <div class="box"><div class="muted">HE Calculadas</div><div class="value" id="kpiHeCalc">00:00</div></div>
          <div class="box"><div class="muted">HE Pagadas (cap 40h)</div><div class="value" id="kpiHePay">00:00</div></div>
          <div class="box"><div class="muted">TXT (Bols√≥n)</div><div class="value" id="kpiTxt">00:00</div></div>
          <!-- CAMBIO DE ETIQUETA -->
          <div class="box"><div class="muted">Beneficios (Alim+Transp)</div><div class="value" id="kpiBen">USD 0.00</div></div>
        </div>
        
        <!-- NUEVA TARJETA TOTAL -->
        <div style="margin-top:10px; background:#fffcf0; border:2px solid #bf9000; border-radius:10px; padding:15px; text-align:center;">
           <div style="font-size:12px; color:#bf9000; font-weight:bold; text-transform:uppercase;">TOTAL A PAGAR</div>
           <div id="kpiTotalGeneral" style="font-size:24px; font-weight:bold; color:#333; margin-top:5px;">USD 0.00</div>
        </div>

        <!-- SECCI√ìN MOVIDA: DETALLE (AHORA EST√Å ARRIBA) -->
        <div class="card" style="margin-top:20px; border-top:4px solid #0b1f3a;">
          <h1>Detalle</h1>
          <div class="tabs">
            <div class="tab active" data-tab="tab-asi">Asistencia</div>
            <div class="tab" data-tab="tab-he">HE + TXT</div>
            <div class="tab" data-tab="tab-ben">Beneficios</div>
            <div class="tab" data-tab="tab-cycles">Resumen ciclo</div>
          </div>

          <div id="tab-asi" class="tab-content active" style="margin-top:10px;">
            <div class="scroll">
              <table><thead id="headAsistencia"></thead><tbody id="bodyAsistencia"></tbody></table>
            </div>
          </div>
          <div id="tab-he" class="tab-content" style="margin-top:10px;">
            <div class="scroll">
              <table><thead id="headHE"></thead><tbody id="bodyHE"></tbody></table>
            </div>
          </div>
          <div id="tab-ben" class="tab-content" style="margin-top:10px;">
            <div class="scroll">
              <table><thead id="headBEN"></thead><tbody id="bodyBEN"></tbody></table>
            </div>
          </div>
          <div id="tab-cycles" class="tab-content" style="margin-top:10px;">
            <div class="scroll">
              <table><thead id="headCYC"></thead><tbody id="bodyCYC"></tbody></table>
            </div>
          </div>
        </div>
        <!-- FIN SECCI√ìN DETALLE -->


        <h1 style="margin-top:20px;">Gr√°ficos</h1>
        <div class="charts-grid">
          <div class="card" style="box-shadow:none;">
            <div class="muted">Horas por tipo de d√≠a (HE Calc / HE Pagable)</div>
            <canvas id="chartDayType"></canvas>
          </div>

          <div class="card" style="box-shadow:none;">
            <div class="muted">Beneficios por tipo de d√≠a (Alimentaci√≥n / Transporte)</div>
            <canvas id="chartBenefits"></canvas>
          </div>
        </div>

        <div class="card" style="margin-top:12px; box-shadow:none;">
          <div class="muted">Cierre por ciclo (CAP 40h): HE pagadas vs TXT</div>
            <div style="height: 350px; position: relative; width: 100%;">
              <canvas id="chartCycles"></canvas>
            </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    (function(){
      const el = document.getElementById("currentDateTime");
      function tick(){
        const d = new Date();
        el.textContent = d.toLocaleString("es-PA", { dateStyle:"short", timeStyle:"short" }) + "  | Dashboard Recursos Humanos ¬∑ v1.0";
      }
      tick(); setInterval(tick, 10000);
    })();
  </script>

  <script src="./app.js?v=9"></script>
</body>
</html>
